"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5298],{5298:(Z,h,l)=>{l.r(h),l.d(h,{MensajePasajeroPageModule:()=>C});var p=l(6814),j=l(95),o=l(3614),m=l(9351),f=l(5037),e=l(9468),P=l(118);function M(n,i){if(1&n&&(e.TgZ(0,"ion-col",15)(1,"span",16)(2,"span",17),e._uU(3),e.qZA(),e._uU(4),e.qZA()()),2&n){const s=e.oxw().$implicit;e.xp6(3),e.hij("(",s.fecha,")"),e.xp6(1),e.hij(" ",s.texto," ")}}function v(n,i){if(1&n&&(e.TgZ(0,"ion-col",18)(1,"span",16)(2,"span",17),e._uU(3),e.qZA(),e._uU(4),e.qZA()()),2&n){const s=e.oxw().$implicit;e.xp6(3),e.hij("(",s.fecha,")"),e.xp6(1),e.hij(" ",s.texto," ")}}function b(n,i){if(1&n&&(e.TgZ(0,"ion-row",12),e.YNc(1,M,5,2,"ion-col",13),e.YNc(2,v,5,2,"ion-col",14),e.qZA()),2&n){const s=i.$implicit;e.xp6(1),e.Q6J("ngIf",s.sent),e.xp6(1),e.Q6J("ngIf",!s.sent)}}const x=[{path:"",component:(()=>{var n;class i{constructor(a,r,d){this.router=a,this.activatedRoute=r,this.db=d,this.chat=[],this.mensajeInput="",this.activatedRoute.queryParams.subscribe(u=>{var c,t;null!==(c=this.router.getCurrentNavigation())&&void 0!==c&&c.extras.state&&(this.id_pareja=null===(t=this.router.getCurrentNavigation())||void 0===t||null===(t=t.extras)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.id_pareja)})}ngOnInit(){this.db.dbState().subscribe(a=>{a&&(this.loadChat(),this.db.fetchMensajes().subscribe(r=>{this.chat=r;for(let d of this.chat)d.id_remitente==localStorage.getItem("uID")&&(d.sent=!0)}))})}loadChat(){let a=localStorage.getItem("uID");a&&(this.chat=this.db.leerConversacion(a,this.id_pareja))}enviarMensaje(){""!==this.mensajeInput.trim()&&this.db.crearMensaje(Number(localStorage.getItem("uID")),this.id_pareja,this.mensajeInput).then(()=>{var a;const d=f.ou.now().setZone("America/Santiago").toFormat("hh:mm a"),u=document.createElement("ion-row");u.classList.add("ion-align-items-center");let c=document.createElement("ion-col");c.classList.add("enviado"),c.setAttribute("size","12"),c.style.textAlign="right";let t=document.createElement("span");t.classList.add("mensaje"),t.style.display="inline-block",t.style.borderRadius="15px",t.style.padding="0.75rem",t.style.color="#222",t.style.backgroundColor="#eee",t.style.borderBottomRightRadius="0";const g=document.createElement("span");g.innerText=`(${d})`,g.style.fontSize="10px",g.style.color="#777",t.appendChild(g),t.appendChild(document.createTextNode(" ")),t.appendChild(document.createTextNode(this.mensajeInput)),c.appendChild(t),u.appendChild(c),null===(a=document.getElementById("mensajesContainer"))||void 0===a||a.appendChild(u),u.scrollIntoView(),this.mensajeInput="",this.loadChat()}).catch(a=>{console.error("Error al almacenar el mensaje: "+a.message)})}}return(n=i).\u0275fac=function(a){return new(a||n)(e.Y36(m.F0),e.Y36(m.gz),e.Y36(P.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-mensaje-conductor"]],inputs:{mensajeInput:"mensajeInput"},decls:17,vars:5,consts:[[3,"translucent"],["color","#1e1e1e"],["slot","start"],["defaultHref","/home","text","Volver",2,"color","white"],["lines","none",1,"item-background-color"],["padding","",1,"background",3,"fullscreen"],["id","mensajesContainer"],["class","ion-align-items-center",4,"ngFor","ngForOf"],[2,"--inner-padding-end","0"],["placeholder","Mensaje",3,"ngModel","ngModelChange"],["size","large","item-right","",2,"--border-radius","0","margin","0",3,"click"],["name","send-sharp"],[1,"ion-align-items-center"],["size","12","class","enviado",4,"ngIf"],["class","recibido","size","12",4,"ngIf"],["size","12",1,"enviado"],[1,"mensaje"],[1,"hora"],["size","12",1,"recibido"]],template:function(a,r){1&a&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-item",4)(5,"ion-label"),e._uU(6),e.qZA()()()(),e.TgZ(7,"ion-content",5)(8,"ion-card")(9,"ion-card-content")(10,"ion-grid",6),e.YNc(11,b,3,2,"ion-row",7),e.qZA()()()(),e.TgZ(12,"ion-footer")(13,"ion-item",8)(14,"ion-input",9),e.NdJ("ngModelChange",function(u){return r.mensajeInput=u}),e.qZA(),e.TgZ(15,"ion-button",10),e.NdJ("click",function(){return r.enviarMensaje()}),e._UZ(16,"ion-icon",11),e.qZA()()()),2&a&&(e.Q6J("translucent",!0),e.xp6(6),e.Oqu(r.chat.uname),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(4),e.Q6J("ngForOf",r.chat),e.xp6(3),e.Q6J("ngModel",r.mensajeInput))},dependencies:[p.sg,p.O5,j.JJ,j.On,o.oU,o.YG,o.Sm,o.PM,o.FN,o.wI,o.W2,o.fr,o.jY,o.Gu,o.gu,o.pK,o.Ie,o.Q$,o.Nd,o.sr,o.j9,o.cs],styles:[".mensaje[_ngcontent-%COMP%]{display:inline-block;border-radius:15px;padding:.75rem;color:#222}.enviado[_ngcontent-%COMP%]{text-align:right}.enviado[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background-color:#eee;border-bottom-right-radius:0}.recibido[_ngcontent-%COMP%]{text-align:left}.recibido[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background-color:#ddd;border-top-left-radius:0}.hora[_ngcontent-%COMP%]{font-size:10px;color:#777}"]}),i})()}];let I=(()=>{var n;class i{}return(n=i).\u0275fac=function(a){return new(a||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[m.Bz.forChild(x),m.Bz]}),i})(),C=(()=>{var n;class i{}return(n=i).\u0275fac=function(a){return new(a||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,j.u5,o.Pc,I]}),i})()}}]);