"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8539],{8539:(v,h,s)=>{s.r(h),s.d(h,{PerfilConductorPageModule:()=>P});var m=s(6814),c=s(95),t=s(3614),d=s(9351),g=s(5861),e=s(9468),f=s(118),p=s(1125);function C(o,u){if(1&o&&(e.TgZ(0,"ion-card")(1,"ion-card-header"),e._uU(2),e.qZA(),e.TgZ(3,"ion-card-content"),e._uU(4),e.qZA()()),2&o){const l=e.oxw();e.xp6(2),e.hij(" ",l.weatherData.name," "),e.xp6(2),e.hij(" Temperatura: ",l.weatherData.main.temp,"\xb0C ")}}const _=function(){return["/"]},b=[{path:"",component:(()=>{var o;class u{constructor(a,n,r,i,T){this.router=a,this.fb=n,this.toastController=r,this.db=i,this.weatherService=T,this.city="Santiago",this.apiKey="ffe31d51024efac03faf1902e771d2b4",this.apiUrl="https://api.openweathermap.org/data/2.5/weather",this.usuario={},this.imagen=null,this.contrasenaActual="",this.nuevaContrasena="",this.confirmarNuevaContrasena="",this.usuario.imagen=null}ngOnInit(){this.db.dbState().subscribe(a=>{a&&this.loadUsuario()})}getWeather(a){this.weatherService.getWeather(a).subscribe(n=>{this.weatherData=n,console.log(this.weatherData)})}loadUsuario(){var a=this;return(0,g.Z)(function*(){let n=localStorage.getItem("uID");n&&(a.usuario=yield a.db.leerUsuarioPorID(n))})()}initForm(){return this.fb.group({nombre:[""],correo:[""],numero_cel:[""],telefono:[""],patente:[""]})}showToast(a,n){var r=this;return(0,g.Z)(function*(){yield(yield r.toastController.create({message:a,duration:5e3,position:"bottom",color:n,buttons:[{icon:"close",role:"cancel"}]})).present()})()}onFileSelected(a){const n=a.target.files[0];n&&(this.usuario.imagen=URL.createObjectURL(n))}cambiarContrasena(){this.validarContrasenaActual()?this.nuevaContrasena===this.confirmarNuevaContrasena?this.validarNuevaContrasena()?this.db.actualizarContrasena(this.usuario.id_usuario,this.nuevaContrasena).then(()=>{this.showToast("Contrase\xf1a actualizada exitosamente","success"),this.contrasenaActual="",this.nuevaContrasena="",this.confirmarNuevaContrasena=""}).catch(a=>{this.showToast("Error al actualizar la contrase\xf1a: "+a.message,"danger")}):this.showToast("La nueva contrase\xf1a no cumple con los requisitos de seguridad","danger"):this.showToast("Las contrase\xf1as nuevas no coinciden","danger"):this.showToast("La contrase\xf1a actual es incorrecta","danger")}validarContrasenaActual(){var a=this;return(0,g.Z)(function*(){const n=yield a.obtenerContrasenaAlmacenada(a.usuario.id_usuario);return a.contrasenaActual===n})()}obtenerContrasenaAlmacenada(a){var n=this;return(0,g.Z)(function*(){try{const r=yield n.db.leerUsuarioPorID(a.toString());return r?r.password:""}catch(r){return console.error("Error al obtener contrase\xf1a almacenada:",r),""}})()}validarNuevaContrasena(){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(this.nuevaContrasena)}guardarCambios1(){this.validarContrasenaActual()?this.validarNuevaContrasena()?this.db.actualizarContrasena(this.usuario.id_usuario,this.nuevaContrasena).then(()=>{this.showToast("Contrase\xf1a cambiada exitosamente","success")}).catch(a=>{this.showToast("Error al cambiar la contrase\xf1a: "+a.message,"danger")}):this.showToast("La nueva contrase\xf1a no cumple con los requisitos de seguridad","danger"):this.showToast("La contrase\xf1a actual es incorrecta","danger")}guardarCambios(){window.location.reload(),this.db.updateUsuario(this.usuario).then(a=>{this.usuario.imagen?this.db.updateImagenUsuario(this.usuario.id_usuario,this.usuario.imagen).then(()=>{this.showToast("Usuario actualizado exitosamente","success")}).catch(n=>{this.showToast("Error al guardar la imagen de perfil: "+n.message,"danger")}):this.showToast(a,"success")}).catch(a=>{console.error("Error al insertar datos:",a);let n="Error al guardar cambios: ";n+=a.message?a.message:"Detalles espec\xedficos del error no disponibles.",this.showToast(n,"danger")})}}return(o=u).\u0275fac=function(a){return new(a||o)(e.Y36(d.F0),e.Y36(c.qu),e.Y36(t.yF),e.Y36(f.J),e.Y36(p.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-perfil-conductor"]],decls:63,vars:16,consts:[[3,"translucent"],["color","#1e1e1e"],["slot","start"],["defaultHref","/inicio-conductor","text","Volver",2,"color","white"],[1,"background",3,"fullscreen"],[1,"ion-text-center"],["id","perfil-imagen"],[3,"src"],["position","stacked"],["type","file","accept","image/*",3,"ngModel","change","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","email",3,"ngModel","ngModelChange"],["type","tel",3,"ngModel","ngModelChange"],[2,"text-align","center"],["color","grey",3,"click"],["type","password",3,"ngModel","ngModelChange"],["color","grey",3,"routerLink","click"],["position","floating"],[3,"ngModel","ngModelChange"],["expand","full",3,"click"],[4,"ngIf"]],template:function(a,n){1&a&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA()()(),e.TgZ(4,"ion-content",4)(5,"ion-card")(6,"ion-card-header")(7,"ion-card-title",5)(8,"ion-thumbnail",6),e._UZ(9,"img",7),e.qZA(),e.TgZ(10,"ion-label"),e._uU(11),e.qZA(),e._UZ(12,"br"),e.TgZ(13,"ion-label"),e._uU(14),e.qZA(),e._UZ(15,"br"),e.TgZ(16,"ion-label"),e._uU(17),e.qZA()()(),e.TgZ(18,"ion-card-content")(19,"ion-list")(20,"ion-item")(21,"ion-label",8),e._uU(22,"Imagen de Perfil"),e.qZA(),e.TgZ(23,"input",9),e.NdJ("change",function(i){return n.onFileSelected(i)})("ngModelChange",function(i){return n.usuario.imagen=i}),e.qZA()(),e.TgZ(24,"ion-item")(25,"ion-label",8),e._uU(26,"Nombre"),e.qZA(),e.TgZ(27,"ion-input",10),e.NdJ("ngModelChange",function(i){return n.usuario.nombre=i}),e.qZA()(),e.TgZ(28,"ion-item")(29,"ion-label",8),e._uU(30,"Correo"),e.qZA(),e.TgZ(31,"ion-input",11),e.NdJ("ngModelChange",function(i){return n.usuario.correo=i}),e.qZA()(),e.TgZ(32,"ion-item")(33,"ion-label",8),e._uU(34,"N\xfamero de Celular"),e.qZA(),e.TgZ(35,"ion-input",12),e.NdJ("ngModelChange",function(i){return n.usuario.numero_cel=i}),e.qZA()()(),e.TgZ(36,"div",13)(37,"ion-button",14),e.NdJ("click",function(){return n.guardarCambios()}),e._uU(38,"Actualizar perfil"),e.qZA()()()(),e.TgZ(39,"ion-card")(40,"ion-card-header")(41,"ion-card-title"),e._uU(42,"Contrase\xf1a"),e.qZA()(),e.TgZ(43,"ion-card-content")(44,"ion-list")(45,"ion-item")(46,"ion-label",8),e._uU(47,"Nueva Contrase\xf1a"),e.qZA(),e.TgZ(48,"ion-input",15),e.NdJ("ngModelChange",function(i){return n.nuevaContrasena=i}),e.qZA()(),e.TgZ(49,"ion-item")(50,"ion-label",8),e._uU(51,"Confirmar Nueva Contrase\xf1a"),e.qZA(),e.TgZ(52,"ion-input",15),e.NdJ("ngModelChange",function(i){return n.confirmarNuevaContrasena=i}),e.qZA()()(),e.TgZ(53,"div",13)(54,"ion-button",16),e.NdJ("click",function(){return n.guardarCambios1()}),e._uU(55,"Cambiar Contrase\xf1a"),e.qZA()()()(),e.TgZ(56,"ion-item")(57,"ion-label",17),e._uU(58,"Ciudad"),e.qZA(),e.TgZ(59,"ion-input",18),e.NdJ("ngModelChange",function(i){return n.city=i}),e.qZA()(),e.TgZ(60,"ion-button",19),e.NdJ("click",function(){return n.getWeather(n.city)}),e._uU(61,"Obtener Clima"),e.qZA(),e.YNc(62,C,5,2,"ion-card",20),e.qZA()),2&a&&(e.Q6J("translucent",!0),e.xp6(4),e.Q6J("fullscreen",!0),e.xp6(5),e.Q6J("src",n.usuario.imagen,e.LSH),e.xp6(2),e.Oqu(n.usuario.nombre),e.xp6(3),e.Oqu(n.usuario.correo),e.xp6(3),e.Oqu(n.usuario.numero_cel),e.xp6(6),e.Q6J("ngModel",n.usuario.imagen),e.xp6(4),e.Q6J("ngModel",n.usuario.nombre),e.xp6(4),e.Q6J("ngModel",n.usuario.correo),e.xp6(4),e.Q6J("ngModel",n.usuario.numero_cel),e.xp6(13),e.Q6J("ngModel",n.nuevaContrasena),e.xp6(4),e.Q6J("ngModel",n.confirmarNuevaContrasena),e.xp6(2),e.Q6J("routerLink",e.DdM(15,_)),e.xp6(5),e.Q6J("ngModel",n.city),e.xp6(3),e.Q6J("ngIf",n.weatherData))},dependencies:[m.O5,c.Fj,c.JJ,c.On,t.oU,t.YG,t.Sm,t.PM,t.FN,t.Zi,t.Dq,t.W2,t.Gu,t.pK,t.Ie,t.Q$,t.q_,t.Bs,t.sr,t.j9,t.cs,t.YI,d.rH],styles:["#perfil-imagen[_ngcontent-%COMP%]{margin:auto;--size:140px;border-radius:50%;overflow:clip}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start:0px}ion-thumbnail.round[_ngcontent-%COMP%]{border-radius:50%;overflow:clip}.userIcon[_ngcontent-%COMP%]{--size:40px;margin-left:16px}ion-item[_ngcontent-%COMP%]{color:#1e1e1e;background-color:#1e1e1e}ion-button[_ngcontent-%COMP%]{border-radius:10px;background-color:#1e1e1e;color:#fff;width:80%;height:50px}"]}),u})()}];let Z=(()=>{var o;class u{}return(o=u).\u0275fac=function(a){return new(a||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[d.Bz.forChild(b),d.Bz]}),u})(),P=(()=>{var o;class u{}return(o=u).\u0275fac=function(a){return new(a||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.ez,c.u5,t.Pc,c.UX,Z]}),u})()}}]);