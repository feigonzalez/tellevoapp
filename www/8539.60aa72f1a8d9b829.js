"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8539],{8539:(P,h,s)=>{s.r(h),s.d(h,{PerfilConductorPageModule:()=>b});var C=s(6814),l=s(95),a=s(3614),d=s(9351),g=s(5861),e=s(9468),f=s(118);const m=function(){return["/"]},p=[{path:"",component:(()=>{var r;class u{constructor(o,n,t,i){this.router=o,this.fb=n,this.toastController=t,this.db=i,this.usuario={},this.imagen=null,this.contrasenaActual="",this.nuevaContrasena="",this.confirmarNuevaContrasena="",this.usuario.imagen=null}ngOnInit(){this.db.dbState().subscribe(o=>{o&&this.loadUsuario()})}loadUsuario(){var o=this;return(0,g.Z)(function*(){let n=localStorage.getItem("uID");n&&(o.usuario=yield o.db.leerUsuarioPorID(n))})()}initForm(){return this.fb.group({nombre:[""],correo:[""],numero_cel:[""],telefono:[""],patente:[""]})}showToast(o,n){var t=this;return(0,g.Z)(function*(){yield(yield t.toastController.create({message:o,duration:5e3,position:"bottom",color:n,buttons:[{icon:"close",role:"cancel"}]})).present()})()}onFileSelected(o){const n=o.target.files[0];n&&(this.usuario.imagen=URL.createObjectURL(n))}cambiarContrasena(){this.validarContrasenaActual()?this.nuevaContrasena===this.confirmarNuevaContrasena?this.validarNuevaContrasena()?this.db.actualizarContrasena(this.usuario.id_usuario,this.nuevaContrasena).then(()=>{this.showToast("Contrase\xf1a actualizada exitosamente","success"),this.contrasenaActual="",this.nuevaContrasena="",this.confirmarNuevaContrasena=""}).catch(o=>{this.showToast("Error al actualizar la contrase\xf1a: "+o.message,"danger")}):this.showToast("La nueva contrase\xf1a no cumple con los requisitos de seguridad","danger"):this.showToast("Las contrase\xf1as nuevas no coinciden","danger"):this.showToast("La contrase\xf1a actual es incorrecta","danger")}validarContrasenaActual(){var o=this;return(0,g.Z)(function*(){const n=yield o.obtenerContrasenaAlmacenada(o.usuario.id_usuario);return o.contrasenaActual===n})()}obtenerContrasenaAlmacenada(o){var n=this;return(0,g.Z)(function*(){try{const t=yield n.db.leerUsuarioPorID(o.toString());return t?t.password:""}catch(t){return console.error("Error al obtener contrase\xf1a almacenada:",t),""}})()}validarNuevaContrasena(){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(this.nuevaContrasena)}guardarCambios1(){this.validarContrasenaActual()?this.validarNuevaContrasena()?this.db.actualizarContrasena(this.usuario.id_usuario,this.nuevaContrasena).then(()=>{this.showToast("Contrase\xf1a cambiada exitosamente","success")}).catch(o=>{this.showToast("Error al cambiar la contrase\xf1a: "+o.message,"danger")}):this.showToast("La nueva contrase\xf1a no cumple con los requisitos de seguridad","danger"):this.showToast("La contrase\xf1a actual es incorrecta","danger")}guardarCambios(){this.db.updateUsuario(this.usuario).then(o=>{this.usuario.imagen?this.db.updateImagenUsuario(this.usuario.id_usuario,this.usuario.imagen).then(()=>{this.showToast("Usuario actualizado exitosamente","success")}).catch(n=>{this.showToast("Error al guardar la imagen de perfil: "+n.message,"danger")}):this.showToast(o,"success")}).catch(o=>{console.error("Error al insertar datos:",o);let n="Error al guardar cambios: ";n+=o.message?o.message:"Detalles espec\xedficos del error no disponibles.",this.showToast(n,"danger")})}}return(r=u).\u0275fac=function(o){return new(o||r)(e.Y36(d.F0),e.Y36(l.qu),e.Y36(a.yF),e.Y36(f.J))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-perfil-conductor"]],decls:53,vars:17,consts:[[3,"translucent"],["color","#1e1e1e"],["slot","start"],["defaultHref","/inicio-conductor","text","Volver",2,"color","white"],[1,"background",3,"fullscreen"],[1,"ion-text-center"],["id","perfil-imagen"],[3,"src"],["position","stacked"],["type","file","accept","image/*",3,"ngModel","change","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","email",3,"ngModel","ngModelChange"],["type","tel",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[2,"text-align","center"],["color","grey",3,"routerLink","click"]],template:function(o,n){1&o&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA()()(),e.TgZ(4,"ion-content",4)(5,"ion-card")(6,"ion-card-header")(7,"ion-card-title",5)(8,"ion-thumbnail",6),e._UZ(9,"img",7),e.qZA(),e.TgZ(10,"ion-label"),e._uU(11),e.qZA(),e._UZ(12,"br"),e.TgZ(13,"ion-label"),e._uU(14),e.qZA(),e._UZ(15,"br"),e.TgZ(16,"ion-label"),e._uU(17),e.qZA()()(),e.TgZ(18,"ion-card-content")(19,"ion-list")(20,"ion-item")(21,"ion-label",8),e._uU(22,"Imagen de Perfil"),e.qZA(),e.TgZ(23,"input",9),e.NdJ("change",function(i){return n.onFileSelected(i)})("ngModelChange",function(i){return n.usuario.imagen=i}),e.qZA()(),e.TgZ(24,"ion-item")(25,"ion-label",8),e._uU(26,"Nombre"),e.qZA(),e.TgZ(27,"ion-input",10),e.NdJ("ngModelChange",function(i){return n.usuario.nombre=i}),e.qZA()(),e.TgZ(28,"ion-item")(29,"ion-label",8),e._uU(30,"Correo"),e.qZA(),e.TgZ(31,"ion-input",11),e.NdJ("ngModelChange",function(i){return n.usuario.correo=i}),e.qZA()(),e.TgZ(32,"ion-item")(33,"ion-label",8),e._uU(34,"N\xfamero de Celular"),e.qZA(),e.TgZ(35,"ion-input",12),e.NdJ("ngModelChange",function(i){return n.usuario.numero_cel=i}),e.qZA()(),e.TgZ(36,"ion-item")(37,"ion-label",8),e._uU(38,"Contrase\xf1a Actual"),e.qZA(),e.TgZ(39,"ion-input",13),e.NdJ("ngModelChange",function(i){return n.contrasenaActual=i}),e.qZA()(),e.TgZ(40,"ion-item")(41,"ion-label",8),e._uU(42,"Nueva Contrase\xf1a"),e.qZA(),e.TgZ(43,"ion-input",13),e.NdJ("ngModelChange",function(i){return n.nuevaContrasena=i}),e.qZA()(),e.TgZ(44,"ion-item")(45,"ion-label",8),e._uU(46,"Confirmar Nueva Contrase\xf1a"),e.qZA(),e.TgZ(47,"ion-input",13),e.NdJ("ngModelChange",function(i){return n.confirmarNuevaContrasena=i}),e.qZA()()(),e.TgZ(48,"div",14)(49,"ion-button",15),e.NdJ("click",function(){return n.guardarCambios()}),e._uU(50,"Actualizar perfil"),e.qZA(),e.TgZ(51,"ion-button",15),e.NdJ("click",function(){return n.guardarCambios1()}),e._uU(52,"Cambiar Contrase\xf1a"),e.qZA()()()()()),2&o&&(e.Q6J("translucent",!0),e.xp6(4),e.Q6J("fullscreen",!0),e.xp6(5),e.Q6J("src",n.usuario.imagen,e.LSH),e.xp6(2),e.Oqu(n.usuario.nombre),e.xp6(3),e.Oqu(n.usuario.correo),e.xp6(3),e.Oqu(n.usuario.numero_cel),e.xp6(6),e.Q6J("ngModel",n.usuario.imagen),e.xp6(4),e.Q6J("ngModel",n.usuario.nombre),e.xp6(4),e.Q6J("ngModel",n.usuario.correo),e.xp6(4),e.Q6J("ngModel",n.usuario.numero_cel),e.xp6(4),e.Q6J("ngModel",n.contrasenaActual),e.xp6(4),e.Q6J("ngModel",n.nuevaContrasena),e.xp6(4),e.Q6J("ngModel",n.confirmarNuevaContrasena),e.xp6(2),e.Q6J("routerLink",e.DdM(15,m)),e.xp6(2),e.Q6J("routerLink",e.DdM(16,m)))},dependencies:[l.Fj,l.JJ,l.On,a.oU,a.YG,a.Sm,a.PM,a.FN,a.Zi,a.Dq,a.W2,a.Gu,a.pK,a.Ie,a.Q$,a.q_,a.Bs,a.sr,a.j9,a.cs,a.YI,d.rH],styles:["#perfil-imagen[_ngcontent-%COMP%]{margin:auto;--size:140px;border-radius:50%;overflow:clip}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start:0px}ion-thumbnail.round[_ngcontent-%COMP%]{border-radius:50%;overflow:clip}.userIcon[_ngcontent-%COMP%]{--size:40px;margin-left:16px}ion-item[_ngcontent-%COMP%]{color:#1e1e1e;background-color:#1e1e1e}ion-button[_ngcontent-%COMP%]{border-radius:10px;background-color:#1e1e1e;color:#fff;width:80%;height:50px}"]}),u})()}];let _=(()=>{var r;class u{}return(r=u).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[d.Bz.forChild(p),d.Bz]}),u})(),b=(()=>{var r;class u{}return(r=u).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[C.ez,l.u5,a.Pc,l.UX,_]}),u})()}}]);