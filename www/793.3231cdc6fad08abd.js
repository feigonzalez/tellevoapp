"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[793],{793:(Z,j,r)=>{r.r(j),r.d(j,{MensajeConductorPageModule:()=>I});var p=r(6814),h=r(95),a=r(3614),m=r(9351),f=r(5037),e=r(9468),M=r(118);function C(n,s){if(1&n&&(e.TgZ(0,"ion-col",15)(1,"span",16)(2,"span",17),e._uU(3),e.qZA(),e._uU(4),e.qZA()()),2&n){const i=e.oxw().$implicit;e.xp6(3),e.hij("(",i.fecha,")"),e.xp6(1),e.hij(" ",i.texto," ")}}function v(n,s){if(1&n&&(e.TgZ(0,"ion-col",18)(1,"span",16)(2,"span",17),e._uU(3),e.qZA(),e._uU(4),e.qZA()()),2&n){const i=e.oxw().$implicit;e.xp6(3),e.hij("(",i.fecha,")"),e.xp6(1),e.hij(" ",i.texto," ")}}function b(n,s){if(1&n&&(e.TgZ(0,"ion-row",12),e.YNc(1,C,5,2,"ion-col",13),e.YNc(2,v,5,2,"ion-col",14),e.qZA()),2&n){const i=s.$implicit;e.xp6(1),e.Q6J("ngIf",i.sent),e.xp6(1),e.Q6J("ngIf",!i.sent)}}const P=[{path:"",component:(()=>{var n;class s{constructor(t,c,d){this.router=t,this.activatedRoute=c,this.db=d,this.chat=[],this.mensajeInput="",this.activatedRoute.queryParams.subscribe(u=>{var l,o;null!==(l=this.router.getCurrentNavigation())&&void 0!==l&&l.extras.state&&(this.id_pareja=null===(o=this.router.getCurrentNavigation())||void 0===o||null===(o=o.extras)||void 0===o||null===(o=o.state)||void 0===o?void 0:o.id_pareja)})}ngOnInit(){this.db.dbState().subscribe(t=>{t&&(this.loadChat(),this.db.fetchMensajes().subscribe(c=>{this.chat=c;for(let d of this.chat)d.id_remitente==localStorage.getItem("uID")&&(d.sent=!0)}))})}loadChat(){let t=localStorage.getItem("uID");t&&(this.chat=this.db.leerConversacion(t,this.id_pareja))}enviarMensaje(){""!==this.mensajeInput.trim()&&this.db.crearMensaje(Number(localStorage.getItem("uID")),this.id_pareja,this.mensajeInput).then(()=>{var t;const d=f.ou.now().setZone("America/Santiago").toFormat("hh:mm a"),u=document.createElement("ion-row");u.classList.add("ion-align-items-center");let l=document.createElement("ion-col");l.classList.add("enviado"),l.setAttribute("size","12"),l.style.textAlign="right";let o=document.createElement("span");o.classList.add("mensaje"),o.style.display="inline-block",o.style.borderRadius="15px",o.style.padding="0.75rem",o.style.color="#222",o.style.backgroundColor="#eee",o.style.borderBottomRightRadius="0";const g=document.createElement("span");g.innerText=`(${d})`,g.style.fontSize="10px",g.style.color="#777",o.appendChild(g),o.appendChild(document.createTextNode(" ")),o.appendChild(document.createTextNode(this.mensajeInput)),l.appendChild(o),u.appendChild(l),null===(t=document.getElementById("mensajesContainer"))||void 0===t||t.appendChild(u),u.scrollIntoView(),this.mensajeInput="",this.loadChat()}).catch(t=>{console.error("Error al almacenar el mensaje: "+t.message)})}}return(n=s).\u0275fac=function(t){return new(t||n)(e.Y36(m.F0),e.Y36(m.gz),e.Y36(M.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-mensaje-conductor"]],inputs:{mensajeInput:"mensajeInput"},decls:17,vars:5,consts:[[3,"translucent"],["color","#1e1e1e"],["slot","start"],["defaultHref","/home","text","Volver",2,"color","white"],["lines","none",1,"item-background-color"],["padding","",1,"background",3,"fullscreen"],["id","mensajesContainer"],["class","ion-align-items-center",4,"ngFor","ngForOf"],[2,"--inner-padding-end","0"],["placeholder","Mensaje",3,"ngModel","ngModelChange"],["size","large","item-right","",2,"--border-radius","0","margin","0",3,"click"],["name","send-sharp"],[1,"ion-align-items-center"],["size","12","class","enviado",4,"ngIf"],["class","recibido","size","12",4,"ngIf"],["size","12",1,"enviado"],[1,"mensaje"],[1,"hora"],["size","12",1,"recibido"]],template:function(t,c){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-item",4)(5,"ion-label"),e._uU(6),e.qZA()()()(),e.TgZ(7,"ion-content",5)(8,"ion-card")(9,"ion-card-content")(10,"ion-grid",6),e.YNc(11,b,3,2,"ion-row",7),e.qZA()()()(),e.TgZ(12,"ion-footer")(13,"ion-item",8)(14,"ion-input",9),e.NdJ("ngModelChange",function(u){return c.mensajeInput=u}),e.qZA(),e.TgZ(15,"ion-button",10),e.NdJ("click",function(){return c.enviarMensaje()}),e._UZ(16,"ion-icon",11),e.qZA()()()),2&t&&(e.Q6J("translucent",!0),e.xp6(6),e.Oqu(c.chat.uname),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(4),e.Q6J("ngForOf",c.chat),e.xp6(3),e.Q6J("ngModel",c.mensajeInput))},dependencies:[p.sg,p.O5,h.JJ,h.On,a.oU,a.YG,a.Sm,a.PM,a.FN,a.wI,a.W2,a.fr,a.jY,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.Nd,a.sr,a.j9,a.cs],styles:[".mensaje[_ngcontent-%COMP%]{display:inline-block;border-radius:15px;padding:.75rem;color:#222}.enviado[_ngcontent-%COMP%]{text-align:right}.enviado[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background-color:#eee;border-bottom-right-radius:0}.recibido[_ngcontent-%COMP%]{text-align:left}.recibido[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background-color:#ddd;border-top-left-radius:0}.hora[_ngcontent-%COMP%]{font-size:10px;color:#777}"]}),s})()}];let x=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[m.Bz.forChild(P),m.Bz]}),s})(),I=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,h.u5,a.Pc,x]}),s})()}}]);