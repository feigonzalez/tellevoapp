"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6062],{6062:(A,j,s)=>{s.r(j),s.d(j,{AdministrarViajePageModule:()=>P});var p=s(6814),h=s(95),t=s(3614),l=s(9351),m=s(5861),a=s(9468),f=s(118);function v(e,n){if(1&e){const r=a.EpF();a.TgZ(0,"ion-row",11)(1,"ion-col",12)(2,"ion-thumbnail",13),a._UZ(3,"img",14),a.qZA()(),a.TgZ(4,"ion-col")(5,"div",15),a._uU(6),a.qZA()(),a.TgZ(7,"ion-col",12)(8,"ion-item",16)(9,"ion-button",17),a.NdJ("click",function(){const c=a.CHM(r).$implicit,u=a.oxw();return a.KtG(u.aceptarPasaje(c))}),a._UZ(10,"ion-icon",18),a.qZA(),a.TgZ(11,"ion-button",19),a.NdJ("click",function(){const c=a.CHM(r).$implicit,u=a.oxw();return a.KtG(u.rechazarPasaje(c))}),a._UZ(12,"ion-icon",20),a.qZA()()()()}if(2&e){const r=n.$implicit;a.xp6(3),a.s9C("src",r.pasajero.imagen,a.LSH),a.xp6(3),a.Oqu(r.pasajero.nombre)}}const V=[{path:"",component:(()=>{var e;class n{constructor(i,o,c){this.db=i,this.activatedRoute=o,this.router=c,this.asResv=0,this.asDisp=0,this.activatedRoute.queryParams.subscribe(u=>{var g,d;null!==(g=this.router.getCurrentNavigation())&&void 0!==g&&g.extras.state&&(this.ruta=null===(d=this.router.getCurrentNavigation())||void 0===d||null===(d=d.extras.state)||void 0===d?void 0:d.ruta)})}ngOnInit(){this.db.dbState().subscribe(i=>{i&&(this.db.fetchViajes().subscribe(o=>{this.viajes=o}),this.loadVehiculo(),this.loadViajes())})}loadVehiculo(){var i=this;return(0,m.Z)(function*(){let o=localStorage.getItem("uID");o&&(i.vehiculo=yield i.db.leerVehiculoPorUsuario(o),i.asDisp=i.vehiculo.n_asientos)})()}loadViajes(){var i=this;return(0,m.Z)(function*(){if(i.ruta){i.asResv=yield i.db.contarViajesPorRutaYEstado(i.ruta.id_ruta,"aceptado"),yield i.db.leerViajesPorRutaYEstado(i.ruta.id_ruta,"solicitado");for(let o of i.viajes)o.pasajero=yield i.db.leerUsuarioPorID(o.id_pasajero)}})()}aceptarPasaje(i){this.asResv==this.asDisp?this.db.showToast("Cantidad m\xe1xima de solicitudes alcanzada","danger"):(this.db.actualizarViaje(i.id_viaje,i.tarifa,i.fecha,"aceptado",i.id_ruta,i.id_pasajero),this.loadViajes())}rechazarPasaje(i){this.db.actualizarViaje(i.id_viaje,i.tarifa,i.fecha,"rechazado",i.id_ruta,i.id_pasajero),this.loadViajes()}comenzarViaje(){var i=this;return(0,m.Z)(function*(){i.ruta&&(yield i.db.actualizarViajesPorInicio(i.ruta.id_ruta),i.loadViajes()),i.router.navigate(["/viaje-conductor"],{state:{ruta:i.ruta,viewType:"view"}})})()}}return(e=n).\u0275fac=function(i){return new(i||e)(a.Y36(f.J),a.Y36(l.gz),a.Y36(l.F0))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-administrar-viaje"]],decls:18,vars:5,consts:[[3,"translucent"],["color","#1e1e1e"],["slot","start"],["defaultHref","/ver-ruta","text","Volver",2,"color","white"],["padding","",1,"background",3,"fullscreen"],[2,"margin-bottom","94px"],[1,"ion-text-center",2,"color","#1e1e1e"],["class","ion-align-items-center",4,"ngFor","ngForOf"],[1,"footer",2,"background","#fff"],[2,"text-align","center"],["expand","block","size","large",2,"display","inline-block","margin","1rem",3,"click"],[1,"ion-align-items-center"],["size","auto"],[1,"user-icon","round"],[3,"src"],[1,"pasajeroNombre"],["lines","none",2,"margin-right","calc(0px - var(--ion-safe-area-right, 0px) - var(--inner-padding-end))"],["color","success",1,"round-icon",3,"click"],["slot","icon-only","name","checkmark-sharp"],["color","danger",1,"round-icon",3,"click"],["name","close-sharp"]],template:function(i,o){1&i&&(a.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),a._UZ(3,"ion-back-button",3),a.qZA()()(),a.TgZ(4,"ion-content",4)(5,"ion-card",5)(6,"ion-card-header")(7,"ion-card-title",6),a._uU(8,"Solicitudes de Pasaje"),a.qZA(),a.TgZ(9,"ion-card-subtitle",6),a._uU(10),a.qZA()(),a.TgZ(11,"ion-card-content")(12,"ion-grid"),a.YNc(13,v,13,2,"ion-row",7),a.qZA()()()(),a.TgZ(14,"ion-footer",8)(15,"div",9)(16,"ion-button",10),a.NdJ("click",function(){return o.comenzarViaje()}),a._uU(17,"Comenzar Viaje"),a.qZA()()()),2&i&&(a.Q6J("translucent",!0),a.xp6(4),a.Q6J("fullscreen",!0),a.xp6(6),a.AsE("",o.asResv," / ",o.asDisp," asientos reservados"),a.xp6(3),a.Q6J("ngForOf",o.viajes))},dependencies:[p.sg,t.oU,t.YG,t.Sm,t.PM,t.FN,t.Zi,t.tO,t.Dq,t.wI,t.W2,t.fr,t.jY,t.Gu,t.gu,t.Ie,t.Nd,t.Bs,t.sr,t.cs]}),n})()}];let b=(()=>{var e;class n{}return(e=n).\u0275fac=function(i){return new(i||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[l.Bz.forChild(V),l.Bz]}),n})(),P=(()=>{var e;class n{}return(e=n).\u0275fac=function(i){return new(i||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[p.ez,h.u5,t.Pc,b]}),n})()}}]);